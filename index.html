<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AcoustiSkin "Pro-Connect" CRM - Enterprise Tier 3</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    /* Custom styles for professional, clean look */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Inter', sans-serif;
      background: #f4f7f9;
      min-height: 100vh;
    }
    .sidebar { 
      width: 280px; 
      /* Deep Green/Black for Enterprise feel */
      background: linear-gradient(180deg, #1e3a24 0%, #0c1a0f 100%); 
      box-shadow: 4px 0 20px rgba(0,0,0,0.25);
    }
    .nav-item {
      padding: 1rem 1.5rem;
      color: #b0c4b1;
      display: flex;
      align-items: center;
      transition: background 0.3s, color 0.3s;
      cursor: pointer;
    }
    .nav-item:hover, .nav-item.active {
      background: #2e5940;
      color: #ffffff;
      /* Neon Green accent */
      border-left: 5px solid #a3e635; 
    }
    .nav-item i {
      width: 25px;
      margin-right: 12px;
      text-align: center;
    }
    /* Calendar specific style */
    .calendar-cell {
      min-height: 100px; /* Ensure visibility */
    }
  </style>
</head>
<body class="flex">

  <div class="sidebar flex flex-col h-screen fixed">
    <div class="p-6 text-2xl font-bold text-white tracking-widest border-b border-gray-700">
      AcoustiSkin
      <div class="text-xs text-gray-400 font-normal">AI-Powered Enterprise Edition</div>
    </div>
    <nav class="flex-grow pt-4" id="main-nav">
      <div class="nav-item active" data-view="dashboard"><i class="fas fa-chart-line"></i> Dashboard</div>
      <div class="nav-item" data-view="customers"><i class="fas fa-users"></i> Customers</div>
      <div class="nav-item" data-view="orders"><i class="fas fa-shopping-cart"></i> Orders</div>
      <div class="nav-item" data-view="calendar"><i class="fas fa-calendar-alt"></i> Calendar</div>
      <div class="nav-item" data-view="communications"><i class="fas fa-comments"></i> Communications</div>
      <div class="nav-item" data-view="tasks"><i class="fas fa-tasks"></i> Tasks</div>
      <div class="nav-item" data-view="pipeline"><i class="fas fa-funnel-dollar"></i> Pipeline</div>
      <div class="nav-item" data-view="analytics"><i class="fas fa-chart-area"></i> Analytics</div>
      <div class="nav-item" data-view="marketing"><i class="fas fa-bullhorn"></i> Marketing</div>
      <div class="nav-item" data-view="referralProgram"><i class="fas fa-share-alt"></i> Referral Program</div>
    </nav>
    
    <div class="p-4 border-t border-gray-700">
      <div class="text-sm font-semibold text-gray-400 mb-2">Data Utilities</div>
      <div class="text-xs text-gray-500 mb-2"><i class="fas fa-clock"></i> Last Backup: Yesterday</div>
      <button onclick="emailBackup()" class="w-full text-left py-2 px-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg transition"><i class="fas fa-paper-plane"></i> Email Backup</button>
      <button onclick="downloadBackup()" class="w-full text-left py-2 px-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg transition"><i class="fas fa-download"></i> Download Backup</button>
      <button onclick="document.getElementById('importFileInput').click()" class="w-full text-left py-2 px-3 text-sm text-gray-200 hover:bg-gray-700 rounded-lg transition"><i class="fas fa-upload"></i> Import Data</button>
      <input type="file" id="importFileInput" style="display: none;" onchange="importData(event)">
    </div>
  </div>

  <div class="flex-1 ml-72 p-10"> 
    
    <header class="flex justify-between items-center pb-8 border-b border-gray-300 mb-8">
      <h1 id="currentViewTitle" class="text-3xl font-extrabold text-gray-800">Dashboard</h1>
      <div class="flex space-x-4">
        <button onclick="renderNewCustomerModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-700 transition flex items-center"><i class="fas fa-user-plus mr-2"></i> New Customer</button>
        <button onclick="renderNewOrderModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition flex items-center"><i class="fas fa-plus-square mr-2"></i> New Order</button>
        <button onclick="renderScheduleEventModal()" class="bg-gray-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-700 transition flex items-center"><i class="fas fa-calendar-plus mr-2"></i> Schedule Event</button>
      </div>
    </header>

    <div id="contentArea">
      </div>

  </div>

  <div id="modalContainer" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden justify-center items-center z-50">
    <div id="modalContent" class="bg-white rounded-xl shadow-2xl w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto">
      </div>
  </div>


  <script>
    // ======================================================================
    // 1. DATA STORE (Using localStorage for persistence)
    // ======================================================================
    let crmData = {
      customers: [
        { id: 1, name: 'Reed Kimmel', email: 'reed@gmail.com', mobileNumber: '555-0100', status: 'Active', aiScore: 81, leadSource: 'Google', referralsMade: 0, potentialReferrals: 2, industry: 'Tech', ageRange: '30-40', skillLevel: 'Intermediate', playFrequency: 'Weekly', currentPaddleBrand: 'CRBN', socialEngagementLevel: 'High', notes: 'Very engaged in local tournaments.', createdAt: new Date('2025-10-01') },
        // UPDATED: Anna Lee is now 'Active' and AI Score is 75
        { id: 2, name: 'Anna Lee', email: 'anna@example.com', mobileNumber: '555-0101', status: 'Active', aiScore: 75, leadSource: 'Referral', referralsMade: 0, potentialReferrals: 0, industry: 'Healthcare', ageRange: '40-50', skillLevel: 'Beginner', playFrequency: 'Monthly', currentPaddleBrand: 'Bantam', socialEngagementLevel: 'Low', notes: 'Met at trade show.', createdAt: new Date('2025-11-01') },
      ],
      orders: [
        { id: 101, customerId: 1, customerName: 'Reed Kimmel', product: 'Performance Cover', quantity: 1, price: 69.99, orderDate: new Date('2025-10-15'), status: 'Delivered', notes: '', totalValue: 69.99, referralCode: null },
      ],
      communications: [ // NEW: Placeholder Communications
        { id: 1, customerId: 1, customerName: 'Reed Kimmel', type: 'Email', date: new Date('2025-11-20'), summary: 'Sent Q4 product catalog.', direction: 'Outbound', channel: 'Email', rating: 'Neutral', isFollowUp: false },
        { id: 2, customerId: 2, customerName: 'Anna Lee', type: 'Phone Call', date: new Date('2025-11-25'), summary: 'Discussed beginner paddle options.', direction: 'Inbound', channel: 'Phone', rating: 'Positive', isFollowUp: false },
        { id: 3, customerId: 1, customerName: 'Reed Kimmel', type: 'SMS', date: new Date('2025-11-28'), summary: 'Scheduled follow-up for next week.', direction: 'Outbound', channel: 'SMS', rating: 'Neutral', isFollowUp: true },
      ],
      tasks: [],
      events: [ // PLACEHOLDER EVENTS/REQUESTS FOR CALENDAR
        { id: 1, title: 'Q4 Review Meeting', date: new Date('2025-12-05'), type: 'Internal', notes: 'Discuss Q4 revenue goals.' },
        { id: 2, title: 'Customer Call: Reed Kimmel', date: new Date('2025-12-10'), type: 'Customer', customerId: 1, notes: 'Follow-up on product feedback.' },
        { id: 3, title: 'Trade Show Prep', date: new Date('2025-12-19'), type: 'Internal', notes: 'Finalize booth materials.' },
        { id: 4, title: 'Company Holiday Party', date: new Date('2025-12-24'), type: 'Internal', notes: 'Team building.' },
        { id: 5, title: 'New Customer Prospect', date: new Date('2025-12-30'), type: 'Customer', customerId: 2, notes: 'Follow up with Anna Lee.' },
      ],
      holidays: { // US Federal Holidays (For Calendar View)
        '1/1': 'New Year\'s Day', '1/20': 'MLK Jr. Day', '2/17': 'Presidents\' Day', '5/26': 'Memorial Day',
        '6/19': 'Juneteenth', '7/4': 'Independence Day', '9/1': 'Labor Day', '10/13': 'Columbus Day',
        '11/11': 'Veterans Day', '11/27': 'Thanksgiving Day', '12/25': 'Christmas Day'
      },
      referralSettings: {
        creditAmount: 25,
        minOrderValue: 100,
        tiers: [
          { name: 'Bronze', referrals: '1-2', icon: 'fas fa-medal text-yellow-800' },
          { name: 'Silver', referrals: '3-5', icon: 'fas fa-medal text-gray-400' },
          { name: 'Gold', referrals: '6-10', icon: 'fas fa-medal text-yellow-500' },
          { name: 'Platinum', referrals: '11+', icon: 'fas fa-star text-blue-400' },
        ]
      },
      dashboardMetrics: {
        totalCustomers: 2,
        totalOrders: 1,
        totalRevenue: 69.99,
        eventsToday: 0
      }
    };

    let nextCustomerId = 3;
    let nextOrderId = 102;
    let nextEventId = 6;
    let nextCommId = 4; // NEW: Next ID for Communications
    let currentCalendarDate = new Date(); // New state variable for calendar month

    // ======================================================================
    // 2. CORE UTILITY FUNCTIONS
    // ======================================================================

    function showModal(contentHTML) {
      document.getElementById('modalContent').innerHTML = contentHTML;
      document.getElementById('modalContainer').classList.remove('hidden');
      document.getElementById('modalContainer').classList.add('flex');
    }

    function hideModal() {
      document.getElementById('modalContainer').classList.add('hidden');
      document.getElementById('modalContainer').classList.remove('flex');
    }

    function saveData() {
      localStorage.setItem('acoustiskinCRM_AI', JSON.stringify(crmData));
    }

    function loadData() {
      const saved = localStorage.getItem('acoustiskinCRM_AI');
      if (saved) {
        // Simple conversion of date strings back to Date objects for demo
        const parsed = JSON.parse(saved);
        parsed.orders.forEach(o => o.orderDate = new Date(o.orderDate));
        parsed.customers.forEach(c => c.createdAt = new Date(c.createdAt));
        parsed.events.forEach(e => e.date = new Date(e.date)); // Load events
        parsed.communications.forEach(c => c.date = new Date(c.date)); // Load communications
        crmData = parsed;
        
        // Recalculate IDs for new entries
        if (crmData.customers.length > 0) {
            nextCustomerId = Math.max(...crmData.customers.map(c => c.id)) + 1;
        }
        if (crmData.orders.length > 0) {
            nextOrderId = Math.max(...crmData.orders.map(o => o.id)) + 1;
        }
        if (crmData.events.length > 0) {
            nextEventId = Math.max(...crmData.events.map(e => e.id)) + 1;
        }
        if (crmData.communications.length > 0) {
            nextCommId = Math.max(...crmData.communications.map(c => c.id)) + 1;
        }
      }
    }

    function updateDashboard() {
        crmData.dashboardMetrics.totalCustomers = crmData.customers.length;
        crmData.dashboardMetrics.totalOrders = crmData.orders.length;
        crmData.dashboardMetrics.totalRevenue = crmData.orders.reduce((sum, order) => sum + order.totalValue, 0);
        
        // Calculate events today
        const todayString = new Date().toDateString();
        crmData.dashboardMetrics.eventsToday = crmData.events.filter(e => e.date.toDateString() === todayString).length;

        saveData();
    }

    function deleteCustomer(id) { 
      if (confirm('Are you sure you want to delete this customer and ALL related data (orders, comms, tasks)? This action cannot be undone.')) { 
        crmData.customers = crmData.customers.filter(c => c.id !== id); 
        crmData.orders = crmData.orders.filter(o => o.customerId !== id); 
        crmData.events = crmData.events.filter(e => e.customerId !== id); 
        crmData.communications = crmData.communications.filter(c => c.customerId !== id); 
        crmData.tasks = crmData.tasks.filter(t => t.customerId !== id);
        
        saveData();
        updateDashboard();
        renderView('customers');
        alert('Customer and all related data deleted successfully.');
      }
    }
    
    function deleteOrder(id) {
        if (confirm('Are you sure you want to delete this order?')) {
            crmData.orders = crmData.orders.filter(o => o.id !== id);
            saveData();
            updateDashboard();
            renderView('orders');
            alert('Order deleted successfully.');
        }
    }

    // ======================================================================
    // 3. NAVIGATION & VIEW RENDERING (Fixed Sidebar Logic)
    // ======================================================================

    document.addEventListener('DOMContentLoaded', () => {
        // Load data and recalculate metrics before anything renders
        loadData();
        updateDashboard();

        // FIX: Attach event listeners to all navigation items
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // 1. Remove 'active' class from all navigation items
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                
                // 2. Add 'active' class to the clicked item
                this.classList.add('active');
                
                // 3. Get the view name from the data attribute
                const view = this.getAttribute('data-view');
                
                // 4. Update the header title
                document.getElementById('currentViewTitle').textContent = this.textContent.trim();
                
                // 5. Render the corresponding view
                renderView(view);
            });
        });

        // Initial load: Render the dashboard view first
        renderView('dashboard');
    });

    function renderView(view) {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = ''; 

      switch (view) {
        case 'dashboard':
          renderDashboardView(contentArea);
          break;
        case 'customers':
          renderCustomersView(contentArea);
          break;
        case 'orders':
          renderOrdersView(contentArea);
          break;
        case 'calendar':
          renderCalendarView(contentArea); // FIXED/UPDATED
          break;
        case 'communications':
          renderCommunicationsView(contentArea); // NEW: Now functional
          break;
        case 'tasks':
          renderPlaceholderView(contentArea, 'Tasks', 'Manage your to-do items and follow-ups.', 'fas fa-list-check');
          break;
        case 'pipeline':
          renderPlaceholderView(contentArea, 'Sales Pipeline', 'Track leads from Prospect to Won/Lost stages.', 'fas fa-chart-bar');
          break;
        case 'analytics':
          renderPlaceholderView(contentArea, 'Analytics', 'View detailed reports on sales performance, customer churn, and referral success.', 'fas fa-magnifying-glass-chart');
          break;
        case 'marketing':
          renderPlaceholderView(contentArea, 'Marketing', 'Manage campaigns, automations, and social media engagement recommendations.', 'fas fa-hand-holding-dollar');
          break;
        case 'referralProgram':
          renderReferralProgramView(contentArea);
          break;
        default:
          contentArea.innerHTML = '<h2>View Not Found</h2>';
      }
    }

    function renderPlaceholderView(container, title, description, iconClass) {
      container.innerHTML = `
        <div class="p-8 bg-white rounded-xl shadow-lg">
          <h2 class="text-2xl font-semibold text-gray-800 flex items-center"><i class="${iconClass} mr-3 text-green-600"></i> ${title}</h2>
          <p class="mt-2 text-gray-600">${description}</p>
          <div class="mt-6 p-4 bg-gray-100 rounded text-gray-700">
            <i class="fas fa-tools mr-2"></i> This module is under active development for the Enterprise Tier 3 launch.
          </div>
        </div>
      `;
    }

    // ======================================================================
    // 4. DASHBOARD VIEW
    // ======================================================================
    function renderDashboardView(container) {
      const metrics = crmData.dashboardMetrics;
      container.innerHTML = `
        <div class="grid grid-cols-4 gap-6 mb-8">
          ${renderMetricCard('Total Customers', metrics.totalCustomers, 'fas fa-users', 'bg-blue-100 text-blue-600')}
          ${renderMetricCard('Total Orders', metrics.totalOrders, 'fas fa-shopping-cart', 'bg-yellow-100 text-yellow-600')}
          ${renderMetricCard('Total Revenue', '$' + metrics.totalRevenue.toFixed(2), 'fas fa-dollar-sign', 'bg-green-100 text-green-600')}
          ${renderMetricCard('Events Today', metrics.eventsToday, 'fas fa-calendar-day', 'bg-red-100 text-red-600')}
        </div>
        <div class="grid grid-cols-2 gap-6">
          <div class="p-6 bg-white rounded-xl shadow-lg">
            <h3 class="text-lg font-semibold mb-4 text-gray-800"><i class="fas fa-chart-pie mr-2"></i> AI Score Distribution</h3>
            <canvas id="aiScoreChart"></canvas>
          </div>
          <div class="p-6 bg-white rounded-xl shadow-lg">
            <h3 class="text-lg font-semibold mb-4 text-gray-800"><i class="fas fa-arrow-up-right-dots mr-2"></i> Monthly Revenue Trend</h3>
            <canvas id="revenueChart"></canvas>
          </div>
        </div>
      `;
      // Placeholder chart data
      const highValue = crmData.customers.filter(c => c.aiScore >= 75).length;
      const mediumValue = crmData.customers.filter(c => c.aiScore >= 50 && c.aiScore < 75).length;
      const lowValue = crmData.customers.filter(c => c.aiScore < 50).length;

      new Chart(document.getElementById('aiScoreChart'), {
        type: 'doughnut',
        data: {
          labels: ['High Value (75-100)', 'Medium Value (50-74)', 'Low Value (0-49)'],
          datasets: [{
            data: [highValue, mediumValue, lowValue],
            backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
            hoverOffset: 4
          }]
        }
      });
      new Chart(document.getElementById('revenueChart'), {
        type: 'line',
        data: {
          labels: ['Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar'],
          datasets: [{
            label: 'Revenue',
            data: [crmData.dashboardMetrics.totalRevenue, 120, 180, 250, 300, 450],
            borderColor: '#059669',
            tension: 0.1
          }]
        }
      });
    }

    function renderMetricCard(title, value, iconClass, colorClass) {
      return `
        <div class="p-6 bg-white rounded-xl shadow-lg flex items-center justify-between">
          <div>
            <div class="text-sm font-medium text-gray-500">${title}</div>
            <div class="text-3xl font-bold text-gray-900">${value}</div>
          </div>
          <div class="w-12 h-12 rounded-full flex items-center justify-center ${colorClass}">
            <i class="${iconClass} text-xl"></i>
          </div>
        </div>
      `;
    }


    // ======================================================================
    // 5. CUSTOMERS VIEW (STUBS/MOCK FUNCTIONS)
    // ======================================================================
    
    function renderNewCustomerModal() { showModal(`<h3>New Customer Modal (Stub)</h3><p>Form to add new customer goes here.</p><button onclick="hideModal()">Close</button>`); }
    function renderCustomerDetailModal(id) { showModal(`<h3>Customer Detail for ID ${id} (Stub)</h3><p>Detailed view of customer's profile, orders, and comms.</p><button onclick="hideModal()">Close</button>`); }
    function editCustomer(id) { showModal(`<h3>Edit Customer ID ${id} (Stub)</h3><p>Form to edit customer details.</p><button onclick="hideModal()">Close</button>`); }
    function filterCustomers(searchTerm) { 
        const filteredCustomers = crmData.customers.filter(c => c.name.toLowerCase().includes(searchTerm.toLowerCase()));
        // Re-render only the table body for demonstration (full re-render for real app)
        const tableBody = document.getElementById('customerTableBody');
        if (tableBody) {
             tableBody.innerHTML = filteredCustomers.map(c => `
                <tr class="hover:bg-gray-50 transition duration-150">
                    <td class="p-4 whitespace-nowrap text-sm font-medium text-gray-900">${c.name}</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.email}</td>
                    <td class="p-4 whitespace-nowrap text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${c.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${c.status}
                        </span>
                    </td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.aiScore}/100</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.leadSource}</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.referralsMade}</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.potentialReferrals}</td>
                    <td class="p-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="renderCustomerDetailModal(${c.id})" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-eye"></i> View</button>
                        <button onclick="editCustomer(${c.id})" class="text-yellow-600 hover:text-yellow-900 mr-4"><i class="fas fa-edit"></i> Edit</button>
                        <button onclick="deleteCustomer(${c.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>
            `).join('');
        }
    }


    function renderCustomersView(container) {
      const customerRows = crmData.customers.map(c => `
        <tr class="hover:bg-gray-50 transition duration-150">
          <td class="p-4 whitespace-nowrap text-sm font-medium text-gray-900">${c.name}</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.email}</td>
          <td class="p-4 whitespace-nowrap text-sm">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${c.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
              ${c.status}
            </span>
          </td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.aiScore}/100</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.leadSource}</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.referralsMade}</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.potentialReferrals}</td>
          <td class="p-4 whitespace-nowrap text-sm font-medium">
            <button onclick="renderCustomerDetailModal(${c.id})" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-eye"></i> View</button>
            <button onclick="editCustomer(${c.id})" class="text-yellow-600 hover:text-yellow-900 mr-4"><i class="fas fa-edit"></i> Edit</button>
            <button onclick="deleteCustomer(${c.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i> Delete</button>
          </td>
        </tr>
      `).join('');

      container.innerHTML = `
        <div class="p-6 bg-white rounded-xl shadow-lg">
          <h2 class="text-2xl font-bold mb-4 text-gray-800">Customers</h2>
          <div class="flex justify-between items-center mb-6">
            <button onclick="renderNewCustomerModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow-sm hover:bg-green-700 transition flex items-center"><i class="fas fa-user-plus mr-2"></i> Add Customer</button>
            <div class="relative">
              <input type="text" placeholder="Search customers..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500" onkeyup="filterCustomers(this.value)">
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">AI Score</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lead Source</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Referrals Made</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Potential Referrals</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="customerTableBody" class="bg-white divide-y divide-gray-200">
                ${customerRows}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ======================================================================
    // 6. ORDERS VIEW (STUBS/MOCK FUNCTIONS)
    // ======================================================================
    function renderNewOrderModal() { showModal(`<h3>New Order Modal (Stub)</h3><p>Form to add a new order goes here.</p><button onclick="hideModal()">Close</button>`); }
    function viewOrderDetails(id) { showModal(`<h3>Order Details for ID ${id} (Stub)</h3><p>Detailed view of product, shipping, etc.</p><button onclick="hideModal()">Close</button>`); }
    function filterOrders(searchTerm) {
        const filteredOrders = crmData.orders.filter(o => o.customerName.toLowerCase().includes(searchTerm.toLowerCase()) || o.product.toLowerCase().includes(searchTerm.toLowerCase()) || o.id.toString().includes(searchTerm));
        // Re-render only the table body for demonstration (full re-render for real app)
        const tableBody = document.getElementById('orderTableBody');
        if (tableBody) {
             tableBody.innerHTML = filteredOrders.map(o => `
                <tr class="hover:bg-gray-50 transition duration-150">
                    <td class="p-4 whitespace-nowrap text-sm font-medium text-gray-900">${o.id}</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.customerName}</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.product}</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">$${o.totalValue.toFixed(2)}</td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.orderDate.toLocaleDateString()}</td>
                    <td class="p-4 whitespace-nowrap text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                            ${o.status === 'Delivered' ? 'bg-green-100 text-green-800' : o.status === 'Shipped' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${o.status}
                        </span>
                    </td>
                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.referralCode || 'N/A'}</td>
                    <td class="p-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewOrderDetails(${o.id})" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-eye"></i> View</button>
                        <button onclick="deleteOrder(${o.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>
            `).join('');
        }
    }


    function renderOrdersView(container) {
      // Ensure date objects are correctly formatted for display
      const ordersWithFormattedDates = crmData.orders.map(o => ({
        ...o,
        orderDate: o.orderDate instanceof Date ? o.orderDate : new Date(o.orderDate)
      }));

      const orderRows = ordersWithFormattedDates.map(o => `
        <tr class="hover:bg-gray-50 transition duration-150">
          <td class="p-4 whitespace-nowrap text-sm font-medium text-gray-900">${o.id}</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.customerName}</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.product}</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">$${o.totalValue.toFixed(2)}</td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.orderDate.toLocaleDateString()}</td>
          <td class="p-4 whitespace-nowrap text-sm">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
              ${o.status === 'Delivered' ? 'bg-green-100 text-green-800' : o.status === 'Shipped' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'}">
              ${o.status}
            </span>
          </td>
          <td class="p-4 whitespace-nowrap text-sm text-gray-500">${o.referralCode || 'N/A'}</td>
          <td class="p-4 whitespace-nowrap text-sm font-medium">
            <button onclick="viewOrderDetails(${o.id})" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-eye"></i> View</button>
            <button onclick="deleteOrder(${o.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i> Delete</button>
          </td>
        </tr>
      `).join('');

      container.innerHTML = `
        <div class="p-6 bg-white rounded-xl shadow-lg">
          <h2 class="text-2xl font-bold mb-4 text-gray-800">Orders List</h2>
          <div class="flex justify-between items-center mb-6">
            <button onclick="renderNewOrderModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow-sm hover:bg-blue-700 transition flex items-center"><i class="fas fa-plus-square mr-2"></i> Add Order</button>
            <div class="relative">
              <input type="text" placeholder="Search orders..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" onkeyup="filterOrders(this.value)">
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Value</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ref. Code</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="orderTableBody" class="bg-white divide-y divide-gray-200">
                ${orderRows}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }
    
    // ======================================================================
    // 7. CALENDAR VIEW (FIXED AND ENHANCED)
    // ======================================================================

    function showEventDetails(id) {
        const event = crmData.events.find(e => e.id === id);
        if (!event) return;
        const customer = crmData.customers.find(c => c.id === event.customerId);
        const customerInfo = customer ? `<p class="mt-2 text-sm text-gray-600">Customer: <span class="font-semibold">${customer.name}</span> (${customer.email})</p>` : '';

        showModal(`
            <div class="p-6">
                <h3 class="text-2xl font-bold text-gray-800">${event.title}</h3>
                <button onclick="hideModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
                <div class="mt-4 space-y-2">
                    <p class="text-md text-gray-700"><i class="fas fa-calendar-day mr-2 text-green-600"></i> Date: <span class="font-semibold">${event.date.toLocaleDateString()}</span></p>
                    <p class="text-md text-gray-700"><i class="fas fa-tag mr-2 text-blue-600"></i> Type: <span class="font-semibold">${event.type}</span></p>
                    ${customerInfo}
                    <p class="text-md text-gray-700"><i class="fas fa-sticky-note mr-2 text-yellow-600"></i> Notes: ${event.notes || 'No details provided.'}</p>
                </div>
            </div>
        `);
    }

    function renderScheduleEventModal() { showModal(`<h3>Schedule New Event (Stub)</h3><p>Form to create a new calendar event.</p><button onclick="hideModal()">Close</button>`); }


    function renderCalendarView(container) {
      // Use the global state for the current month being viewed (initial is today's date)
      const targetDate = currentCalendarDate;
      container.innerHTML = `
        <div class="p-6 bg-white rounded-xl shadow-lg h-full">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Sales & Team Calendar</h2>
            ${generateCalendarHTML(targetDate)}
        </div>
      `;
    }

    // Navigation function to change the month
    function changeMonth(delta) {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
        // Ensure to re-render the view
        renderView('calendar');
    }

    // Helper to generate the core calendar structure
    function generateCalendarHTML(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const today = new Date();

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        let calendarHTML = `
            <div class="flex justify-between items-center mb-4">
                <button onclick="changeMonth(-1)" class="text-xl font-bold text-gray-600 hover:text-green-600"><i class="fas fa-arrow-left"></i></button>
                <h3 class="text-xl font-bold text-gray-800">${monthNames[month]} ${year}</h3>
                <button onclick="changeMonth(1)" class="text-xl font-bold text-gray-600 hover:text-green-600"><i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="grid grid-cols-7 text-center font-semibold text-gray-600 border-b pb-2">
                ${dayNames.map(day => `<div class="p-2">${day}</div>`).join('')}
            </div>
            <div class="grid grid-cols-7 gap-px border border-gray-200 rounded-lg overflow-hidden min-h-[600px]">
        `;

        let currentDay = new Date(firstDay);
        currentDay.setDate(currentDay.getDate() - currentDay.getDay()); // Start on the first Sunday

        // Generate cells for up to 6 weeks
        for (let i = 0; i < 42; i++) {
            const dayOfMonth = currentDay.getDate();
            const isCurrentMonth = currentDay.getMonth() === month;
            const isToday = currentDay.toDateString() === today.toDateString();
            
            // FIX: Holiday lookup was missing the year
            const holidayKey = `${currentDay.getMonth() + 1}/${dayOfMonth}`;
            const holidayName = (currentDay.getFullYear() === year) ? crmData.holidays[holidayKey] : null; 
            
            // Filter events for this specific date, ensuring comparison is made with Date objects
            const events = crmData.events.filter(e => e.date.toDateString() === currentDay.toDateString());

            // Determine cell styling
            let cellClasses = `calendar-cell p-2 border-r border-b relative group transition duration-100 `;
            if (isCurrentMonth) {
                cellClasses += 'bg-white hover:bg-gray-100';
            } else {
                cellClasses += 'bg-gray-50 text-gray-400';
            }
            if (isToday) {
                cellClasses += ' ring-2 ring-green-500 z-10';
            }
            if (holidayName) {
                cellClasses += ' bg-red-50/50';
            }
            
            // Adjust border for the last column and row
            if ((i + 1) % 7 === 0) cellClasses = cellClasses.replace('border-r', '');
            if (i >= 35) cellClasses = cellClasses.replace('border-b', '');


            // Generate content
            let contentHTML = `
                <div class="text-right text-sm font-bold ${isToday ? 'text-green-700' : isCurrentMonth ? 'text-gray-900' : 'text-gray-400'}">${dayOfMonth}</div>
                <div class="space-y-1 mt-1 text-left">
            `;

            if (holidayName) {
                contentHTML += `<div class="text-xs font-medium text-red-700 bg-red-100 px-1 rounded-sm truncate" title="${holidayName}"><i class="fas fa-star mr-1"></i> ${holidayName}</div>`;
            }

            events.forEach(event => {
                const customer = crmData.customers.find(c => c.id === event.customerId);
                const title = customer ? `${event.title} (${customer.name.split(' ')[0]})` : event.title;
                contentHTML += `<div class="text-xs font-medium text-blue-800 bg-blue-100 px-1 rounded-sm truncate cursor-pointer hover:bg-blue-200" title="${event.title}" onclick="showEventDetails(${event.id})"><i class="fas fa-circle-dot mr-1 text-xs"></i> ${title}</div>`;
            });

            contentHTML += `</div>`; // Close space-y-1 div

            calendarHTML += `<div class="${cellClasses}">${contentHTML}</div>`;

            currentDay.setDate(currentDay.getDate() + 1); // Move to the next day

            // Stop if we've moved past the target month AND completed the week
            if (i > 6 && currentDay.getDay() === 0 && currentDay.getMonth() !== month) break;
        }
        
        calendarHTML += `</div>`; // Close grid container
        return calendarHTML;
    }


    // ======================================================================
    // 8. COMMUNICATIONS VIEW (NEW)
    // ======================================================================

    function renderCommunicationsView(container) {
      // Sort communications by date descending (most recent first)
      const sortedComms = [...crmData.communications].sort((a, b) => b.date.getTime() - a.date.getTime());

      const commRows = sortedComms.map(c => {
          // Determine icon and color based on channel
          let iconClass = 'fas fa-envelope text-blue-500'; // Default: Email
          let colorClass = 'bg-blue-100 text-blue-800';
          if (c.channel === 'Phone') {
              iconClass = 'fas fa-phone text-green-500';
              colorClass = 'bg-green-100 text-green-800';
          } else if (c.channel === 'SMS') {
              iconClass = 'fas fa-message text-yellow-500';
              colorClass = 'bg-yellow-100 text-yellow-800';
          }
          
          // Determine rating chip color
          let ratingClass = 'bg-gray-200 text-gray-800';
          if (c.rating === 'Positive') {
              ratingClass = 'bg-teal-100 text-teal-800';
          } else if (c.rating === 'Negative') {
              ratingClass = 'bg-red-100 text-red-800';
          }

          return `
            <tr class="hover:bg-gray-50 transition duration-150">
              <td class="p-4 whitespace-nowrap text-sm font-medium text-gray-900">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${colorClass}">
                  <i class="${iconClass.split(' ')[1]} mr-1"></i> ${c.channel}
                </span>
              </td>
              <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.customerName}</td>
              <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.date.toLocaleDateString()}</td>
              <td class="p-4 text-sm text-gray-700">${c.summary}</td>
              <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${ratingClass}">
                  ${c.rating}
                </span>
              </td>
              <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.direction}</td>
              <td class="p-4 whitespace-nowrap text-sm font-medium">
                <button onclick="viewCommunicationDetails(${c.id})" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-eye"></i> View</button>
              </td>
            </tr>
          `;
      }).join('');

      container.innerHTML = `
        <div class="p-6 bg-white rounded-xl shadow-lg">
          <h2 class="text-2xl font-bold mb-4 text-gray-800">Communication History</h2>
          <div class="flex justify-between items-center mb-6">
            <button onclick="renderNewCommunicationModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-sm hover:bg-indigo-700 transition flex items-center"><i class="fas fa-plus-circle mr-2"></i> Log New Communication</button>
            <div class="relative">
              <input type="text" placeholder="Search interactions..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" onkeyup="filterCommunications(this.value)">
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Channel</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Summary</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rating</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Direction</th>
                  <th class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="communicationTableBody" class="bg-white divide-y divide-gray-200">
                ${commRows}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // Stubs for Communication actions
    function renderNewCommunicationModal() { showModal(`<h3>Log New Communication (Stub)</h3><p>Form to log a new interaction with a customer.</p><button onclick="hideModal()">Close</button>`); }
    function viewCommunicationDetails(id) { 
        const comm = crmData.communications.find(c => c.id === id);
        showModal(`
            <div class="p-6">
                <h3 class="text-2xl font-bold text-gray-800">${comm.channel} with ${comm.customerName}</h3>
                <button onclick="hideModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
                <div class="mt-4 space-y-2">
                    <p class="text-md text-gray-700"><i class="fas fa-calendar-day mr-2 text-green-600"></i> Date: <span class="font-semibold">${comm.date.toLocaleDateString()}</span></p>
                    <p class="text-md text-gray-700"><i class="fas fa-arrow-right-arrow-left mr-2 text-blue-600"></i> Direction: <span class="font-semibold">${comm.direction}</span></p>
                    <p class="text-md text-gray-700"><i class="fas fa-face-smile-wink mr-2 text-yellow-600"></i> Rating: <span class="font-semibold">${comm.rating}</span></p>
                    <p class="text-md text-gray-700 mt-4"><i class="fas fa-quote-left mr-2 text-gray-500"></i> Summary: ${comm.summary}</p>
                </div>
            </div>
        `); 
    }
    function filterCommunications(searchTerm) {
        // Simple client-side search for demo purposes
        const filteredComms = crmData.communications.filter(c => 
            c.customerName.toLowerCase().includes(searchTerm.toLowerCase()) || 
            c.summary.toLowerCase().includes(searchTerm.toLowerCase()) ||
            c.channel.toLowerCase().includes(searchTerm.toLowerCase())
        );
        
        const tableBody = document.getElementById('communicationTableBody');
        if (tableBody) {
            // Re-render table body with filtered results (abbreviated content for brevity)
            tableBody.innerHTML = filteredComms.map(c => {
                let iconClass = c.channel === 'Phone' ? 'fas fa-phone text-green-500' : c.channel === 'SMS' ? 'fas fa-message text-yellow-500' : 'fas fa-envelope text-blue-500';
                let colorClass = c.channel === 'Phone' ? 'bg-green-100 text-green-800' : c.channel === 'SMS' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800';
                let ratingClass = c.rating === 'Positive' ? 'bg-teal-100 text-teal-800' : c.rating === 'Negative' ? 'bg-red-100 text-red-800' : 'bg-gray-200 text-gray-800';

                return `
                    <tr class="hover:bg-gray-50 transition duration-150">
                        <td class="p-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${colorClass}">
                                <i class="${iconClass.split(' ')[1]} mr-1"></i> ${c.channel}
                            </span>
                        </td>
                        <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.customerName}</td>
                        <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.date.toLocaleDateString()}</td>
                        <td class="p-4 text-sm text-gray-700">${c.summary}</td>
                        <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${ratingClass}">
                                ${c.rating}
                            </span>
                        </td>
                        <td class="p-4 whitespace-nowrap text-sm text-gray-500">${c.direction}</td>
                        <td class="p-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="viewCommunicationDetails(${c.id})" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-eye"></i> View</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
    }

    // ======================================================================
    // 9. REFERRAL PROGRAM VIEW
    // ======================================================================

    function renderReferralProgramView(container) {
      const settings = crmData.referralSettings;
      const tiersHTML = settings.tiers.map(t => `
        <div class="p-4 border rounded-lg flex items-center bg-white shadow-sm">
          <i class="${t.icon} text-3xl mr-4"></i>
          <div>
            <div class="text-lg font-bold text-gray-800">${t.name} Tier</div>
            <div class="text-sm text-gray-600">Referrals: ${t.referrals}</div>
          </div>
        </div>
      `).join('');

      container.innerHTML = `
        <div class="p-6 bg-white rounded-xl shadow-lg">
          <h2 class="text-2xl font-bold mb-6 text-gray-800">Referral Program Management</h2>
          <div class="grid grid-cols-2 gap-6 mb-8">
            <div class="p-4 bg-green-50 rounded-lg border border-green-200">
              <div class="text-sm font-medium text-green-800">Referral Credit Amount:</div>
              <div class="text-2xl font-bold text-green-900">$${settings.creditAmount}</div>
            </div>
            <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
              <div class="text-sm font-medium text-yellow-800">Min. Order Value for Credit:</div>
              <div class="text-2xl font-bold text-yellow-900">$${settings.minOrderValue}</div>
            </div>
          </div>

          <h3 class="text-xl font-bold mb-4 text-gray-800">Referral Tiers</h3>
          <div class="grid grid-cols-4 gap-4">
            ${tiersHTML}
          </div>

          <div class="mt-8">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Active Referrers (Mock)</h3>
            <div class="grid grid-cols-3 gap-4">
              <div class="p-4 bg-gray-100 rounded-lg">Reed Kimmel: <span class="font-semibold">2 Referrals</span></div>
              <div class="p-4 bg-gray-100 rounded-lg">Jane Doe: <span class="font-semibold">6 Referrals</span></div>
              <div class="p-4 bg-gray-100 rounded-lg">John Smith: <span class="font-semibold">1 Referral</span></div>
            </div>
          </div>
        </div>
      `;
    }

    // ======================================================================
    // 10. BACKUP/IMPORT UTILITIES (STUBS)
    // ======================================================================

    function emailBackup() { alert('Simulating emailing backup data...'); }
    function downloadBackup() { 
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(crmData, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "acoustiskin_crm_backup_" + new Date().toISOString().slice(0, 10) + ".json");
        document.body.appendChild(downloadAnchorNode); 
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
        alert('Backup download initiated.');
    }
    function importData(event) { alert('Simulating importing data from selected file...'); }

  </script>

</body>
</html>
