<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AcoustiSkin Enterprise CRM</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- ENTERPRISE THEME ENGINE --- */
        :root {
            --primary: #0f172a; /* Slate 900 */
            --accent: #10b981;  /* Emerald 500 */
            --bg-body: #f1f5f9; /* Slate 100 */
            --glass: rgba(255, 255, 255, 0.95);
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: #334155; }
        
        /* Sidebar Navigation */
        .nav-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 20px; color: #94a3b8;
            border-left: 3px solid transparent; cursor: pointer;
            transition: all 0.2s ease;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: rgba(255,255,255,0.1); color: #fff; border-left-color: var(--accent); }

        /* Modern Card Styling */
        .ent-card {
            background: white; border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03);
            border: 1px solid #e2e8f0; transition: transform 0.2s;
        }
        
        /* Calendar Styling */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e2e8f0; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        .cal-day { background: white; min-height: 120px; padding: 8px; font-size: 0.85rem; cursor: pointer; transition: 0.1s; }
        .cal-day:hover { background: #f8fafc; }
        .is-today { background: #f0fdf4 !important; }
        .holiday-badge { display: block; font-size: 0.7rem; color: #7c3aed; font-weight: 700; margin-bottom: 2px; }
        .event-dot { height: 6px; width: 6px; background-color: var(--accent); border-radius: 50%; display: inline-block; margin-right: 4px; }

        /* Modal Transitions */
        .modal { opacity: 0; visibility: hidden; transition: all 0.2s ease; }
        .modal.open { opacity: 1; visibility: visible; }
        .modal-content { transform: scale(0.95); transition: all 0.2s ease; }
        .modal.open .modal-content { transform: scale(1); }

        /* Utilities */
        .btn { padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; } .btn-primary:hover { background: #1e293b; }
        .btn-accent { background: var(--accent); color: white; } .btn-accent:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; } .btn-danger:hover { background: #dc2626; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-72 bg-slate-900 text-white flex flex-col shadow-2xl z-20">
        <div class="p-6 border-b border-slate-800 flex items-center gap-3">
            <div class="h-10 w-10 bg-emerald-500 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-emerald-500/20">AS</div>
            <div>
                <h1 class="font-bold text-lg tracking-tight">AcoustiSkin</h1>
                <p class="text-xs text-slate-400 uppercase tracking-wider font-semibold">Enterprise CRM</p>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 space-y-1">
            <div class="px-6 pb-2 text-xs font-bold text-slate-500 uppercase tracking-widest">Main Menu</div>
            <div onclick="router.nav('dashboard')" class="nav-item active" id="nav-dashboard"><i class="fa-solid fa-chart-pie w-5"></i> Dashboard</div>
            <div onclick="router.nav('customers')" class="nav-item" id="nav-customers"><i class="fa-solid fa-users w-5"></i> Customers</div>
            <div onclick="router.nav('orders')" class="nav-item" id="nav-orders"><i class="fa-solid fa-box-open w-5"></i> Orders</div>
            <div onclick="router.nav('calendar')" class="nav-item" id="nav-calendar"><i class="fa-solid fa-calendar-days w-5"></i> Calendar</div>
            
            <div class="px-6 pb-2 pt-6 text-xs font-bold text-slate-500 uppercase tracking-widest">Growth</div>
            <div onclick="router.nav('pipeline')" class="nav-item" id="nav-pipeline"><i class="fa-solid fa-filter w-5"></i> Pipeline</div>
            <div onclick="router.nav('reports')" class="nav-item" id="nav-reports"><i class="fa-solid fa-chart-line w-5"></i> Reports</div>
        </nav>

        <div class="p-4 bg-slate-800 border-t border-slate-700">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-full bg-gradient-to-tr from-emerald-500 to-cyan-500 flex items-center justify-center font-bold">DL</div>
                <div>
                    <div class="text-sm font-bold">Dana Lurie</div>
                    <div class="text-xs text-emerald-400">Admin Access</div>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full overflow-hidden relative">
        <header class="h-16 bg-white border-b border-slate-200 flex justify-between items-center px-8 shadow-sm z-10">
            <h2 id="page-title" class="text-xl font-bold text-slate-800">Dashboard</h2>
            <div class="flex gap-3">
                <button onclick="ui.openModal('customer')" class="btn btn-accent text-sm shadow-lg shadow-emerald-500/20"><i class="fa fa-plus"></i> New Customer</button>
                <button onclick="ui.openModal('order')" class="btn btn-primary text-sm"><i class="fa fa-plus"></i> New Order</button>
            </div>
        </header>

        <div id="app-root" class="flex-1 overflow-y-auto p-8">
            </div>
    </main>

    <div id="modal-customer" class="modal fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm">
        <div class="modal-content bg-white w-full max-w-4xl rounded-xl shadow-2xl h-[90vh] flex flex-col">
            <div class="p-6 border-b flex justify-between items-center bg-slate-50 rounded-t-xl">
                <h3 class="text-xl font-bold text-slate-800" id="cust-modal-title">Customer Profile</h3>
                <button onclick="ui.closeModal('customer')" class="text-slate-400 hover:text-red-500"><i class="fa fa-times text-xl"></i></button>
            </div>
            <div class="p-8 overflow-y-auto flex-1">
                <form id="form-customer" onsubmit="app.saveCustomer(event)">
                    <input type="hidden" name="id">
                    
                    <div class="mb-8">
                        <h4 class="text-xs font-bold text-emerald-600 uppercase tracking-widest mb-4 border-b border-emerald-100 pb-2">Identity & Contact</h4>
                        <div class="grid grid-cols-3 gap-6">
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">First Name</label><input name="fName" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" required></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Last Name</label><input name="lName" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" required></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Company</label><input name="company" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none"></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Email</label><input type="email" name="email" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" required></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Phone</label><input name="phone" class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none"></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Status</label><select name="status" class="w-full p-2.5 border rounded-lg"><option>Active</option><option>Lead</option><option>Inactive</option></select></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-12 mb-8">
                        <div>
                            <h4 class="text-xs font-bold text-emerald-600 uppercase tracking-widest mb-4 border-b border-emerald-100 pb-2">Shipping Address</h4>
                            <div class="space-y-4">
                                <input name="ship_addr" placeholder="Street Address" class="w-full p-2.5 border rounded-lg">
                                <div class="grid grid-cols-2 gap-4">
                                    <input name="ship_city" placeholder="City" class="w-full p-2.5 border rounded-lg">
                                    <input name="ship_state" placeholder="State" class="w-full p-2.5 border rounded-lg">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <input name="ship_zip" placeholder="Zip Code" class="w-full p-2.5 border rounded-lg">
                                    <input name="ship_country" placeholder="Country" value="USA" class="w-full p-2.5 border rounded-lg">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between items-center mb-4 border-b border-emerald-100 pb-2">
                                <h4 class="text-xs font-bold text-emerald-600 uppercase tracking-widest">Billing Address</h4>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="sameAsShip" onchange="ui.toggleBilling(this)" class="w-4 h-4 text-emerald-600 rounded">
                                    <span class="text-xs font-bold text-slate-500">Same as Shipping</span>
                                </label>
                            </div>
                            <div class="space-y-4">
                                <input name="bill_addr" id="bill_addr" placeholder="Street Address" class="w-full p-2.5 border rounded-lg">
                                <div class="grid grid-cols-2 gap-4">
                                    <input name="bill_city" id="bill_city" placeholder="City" class="w-full p-2.5 border rounded-lg">
                                    <input name="bill_state" id="bill_state" placeholder="State" class="w-full p-2.5 border rounded-lg">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <input name="bill_zip" id="bill_zip" placeholder="Zip Code" class="w-full p-2.5 border rounded-lg">
                                    <input name="bill_country" id="bill_country" placeholder="Country" value="USA" class="w-full p-2.5 border rounded-lg">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h4 class="text-xs font-bold text-emerald-600 uppercase tracking-widest mb-4 border-b border-emerald-100 pb-2">Marketing & Notes</h4>
                        <div class="grid grid-cols-2 gap-6">
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Internal Notes</label><textarea name="notes" rows="4" class="w-full p-2.5 border rounded-lg"></textarea></div>
                            <div class="space-y-4">
                                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Referral Source</label><input name="source" class="w-full p-2.5 border rounded-lg"></div>
                                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Assign Rep</label><input name="rep" value="Dana Lurie" class="w-full p-2.5 border rounded-lg"></div>
                            </div>
                        </div>
                    </div>

                    <div class="pt-6 border-t flex justify-end gap-3">
                        <button type="button" onclick="ui.closeModal('customer')" class="btn bg-slate-200 hover:bg-slate-300 text-slate-700">Cancel</button>
                        <button type="submit" class="btn btn-accent shadow-lg">Save Profile</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="modal-order" class="modal fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm">
        <div class="modal-content bg-white w-full max-w-2xl rounded-xl shadow-2xl p-8">
            <h3 class="text-xl font-bold text-slate-800 mb-6">Manage Order</h3>
            <form onsubmit="app.saveOrder(event)">
                <input type="hidden" name="id">
                <div class="grid grid-cols-2 gap-6 mb-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Customer</label>
                        <select name="custId" id="ord-cust-select" class="w-full p-3 border rounded-lg bg-slate-50"></select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Date</label>
                        <input type="date" name="date" class="w-full p-3 border rounded-lg" required>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Order Items (Description)</label>
                    <textarea name="items" class="w-full p-3 border rounded-lg h-24" placeholder="List items here..."></textarea>
                </div>
                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Total ($)</label>
                        <input type="number" step="0.01" name="total" class="w-full p-3 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Status</label>
                        <select name="status" class="w-full p-3 border rounded-lg">
                            <option>Processing</option><option>Shipped</option><option>Delivered</option><option>Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="ui.closeModal('order')" class="btn bg-slate-200 hover:bg-slate-300 text-slate-700">Cancel</button>
                    <button type="submit" class="btn btn-primary shadow-lg">Save Order</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-dayview" class="modal fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm">
        <div class="modal-content bg-white w-full max-w-md rounded-xl shadow-2xl p-6">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-lg font-bold" id="day-view-title">Date</h3>
                <button onclick="ui.closeModal('dayview')" class="text-slate-400"><i class="fa fa-times"></i></button>
            </div>
            <div id="day-view-content" class="mb-4 space-y-2"></div>
            <div class="pt-4 border-t">
                <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Add New Event</h4>
                <form onsubmit="app.saveEvent(event)">
                    <input type="hidden" name="date" id="event-date-input">
                    <input name="title" placeholder="Event Title" class="w-full p-2 border rounded mb-2" required>
                    <select name="type" class="w-full p-2 border rounded mb-2"><option>Meeting</option><option>Call</option><option>Task</option></select>
                    <button class="btn btn-accent w-full justify-center">Add Event</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- CORE SYSTEM LOGIC ---
        const app = {
            data: { customers: [], orders: [], events: [], pipeline: [] },
            
            init() {
                const stored = localStorage.getItem('acoustiskin_erp_v1');
                if (stored) {
                    this.data = JSON.parse(stored);
                } else {
                    this.seed();
                }
                router.nav('dashboard');
            },

            seed() {
                // Factory Data for Demo
                this.data.customers = [
                    { id: 'c1', fName: 'Lance', lName: 'Ochs', email: 'lance@cleanroom.com', company: 'CleanRoom Tape', status: 'Active', ship_city: 'Falmouth', ship_state: 'MA' },
                    { id: 'c2', fName: 'Dana', lName: 'Lurie', email: 'dana@acoustiskin.com', company: 'AcoustiSkin', status: 'VIP', ship_city: 'Boston', ship_state: 'MA' }
                ];
                this.data.orders = [
                    { id: 'o1', custId: 'c1', date: '2025-12-01', total: 1250.00, status: 'Shipped', items: 'Bulk Tape Order x50' },
                    { id: 'o2', custId: 'c2', date: '2025-12-05', total: 450.00, status: 'Processing', items: 'Acoustic Panels x10' }
                ];
                this.data.events = [
                    { id: 'e1', date: '2025-12-25', title: 'Christmas Holiday', type: 'Holiday' }
                ];
                this.save();
            },

            save() {
                localStorage.setItem('acoustiskin_erp_v1', JSON.stringify(this.data));
                ui.renderCurrent(); // Re-render active view
            },

            // --- CRUD ACTIONS ---
            saveCustomer(e) {
                e.preventDefault();
                const f = new FormData(e.target);
                const id = f.get('id') || 'c' + Date.now();
                const idx = this.data.customers.findIndex(c => c.id === id);
                
                const cust = Object.fromEntries(f.entries());
                cust.id = id;

                if (idx > -1) this.data.customers[idx] = cust;
                else this.data.customers.push(cust);

                this.save();
                ui.closeModal('customer');
                ui.showToast('Customer Profile Saved');
            },

            saveOrder(e) {
                e.preventDefault();
                const f = new FormData(e.target);
                const id = f.get('id') || 'o' + Date.now();
                const idx = this.data.orders.findIndex(o => o.id === id);
                
                const order = Object.fromEntries(f.entries());
                order.id = id;

                if (idx > -1) this.data.orders[idx] = order;
                else this.data.orders.unshift(order); // Add to top

                this.save();
                ui.closeModal('order');
                ui.showToast('Order Saved Successfully');
            },

            saveEvent(e) {
                e.preventDefault();
                const f = new FormData(e.target);
                this.data.events.push({
                    id: 'e' + Date.now(),
                    date: f.get('date'),
                    title: f.get('title'),
                    type: f.get('type')
                });
                this.save();
                ui.closeModal('dayview');
                if(router.current === 'calendar') ui.renderCalendar(); // Special refresh for calendar
            },

            deleteItem(type, id) {
                if(!confirm("Are you sure? This cannot be undone.")) return;
                this.data[type] = this.data[type].filter(x => x.id !== id);
                this.save();
                ui.showToast('Item Deleted');
            },

            getCustomerName(id) {
                const c = this.data.customers.find(x => x.id === id);
                return c ? `${c.fName} ${c.lName}` : 'Unknown';
            }
        };

        // --- UI RENDERER ---
        const ui = {
            renderCurrent() {
                const root = document.getElementById('app-root');
                const view = router.current;
                
                if (view === 'dashboard') this.renderDashboard(root);
                else if (view === 'customers') this.renderCustomers(root);
                else if (view === 'orders') this.renderOrders(root);
                else if (view === 'calendar') this.renderCalendar(root);
                else root.innerHTML = `<div class="p-10 text-center text-slate-400">Module ${view} under construction</div>`;
            },

            renderDashboard(root) {
                const rev = app.data.orders.reduce((acc, o) => acc + Number(o.total), 0);
                root.innerHTML = `
                    <div class="grid grid-cols-4 gap-6 mb-8">
                        <div class="ent-card p-6 border-l-4 border-emerald-500">
                            <div class="text-xs font-bold text-slate-400 uppercase">Total Revenue</div>
                            <div class="text-3xl font-bold text-slate-800 mt-2">$${rev.toLocaleString()}</div>
                        </div>
                        <div class="ent-card p-6 border-l-4 border-blue-500">
                            <div class="text-xs font-bold text-slate-400 uppercase">Active Customers</div>
                            <div class="text-3xl font-bold text-slate-800 mt-2">${app.data.customers.length}</div>
                        </div>
                        <div class="ent-card p-6 border-l-4 border-purple-500">
                            <div class="text-xs font-bold text-slate-400 uppercase">Orders Pending</div>
                            <div class="text-3xl font-bold text-slate-800 mt-2">${app.data.orders.filter(o=>o.status==='Processing').length}</div>
                        </div>
                        <div class="ent-card p-6 border-l-4 border-orange-500">
                            <div class="text-xs font-bold text-slate-400 uppercase">System Status</div>
                            <div class="text-xl font-bold text-emerald-600 mt-2">Operational</div>
                        </div>
                    </div>
                    <div class="ent-card p-0 overflow-hidden">
                        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                            <h3 class="font-bold text-lg text-slate-800">Recent Orders</h3>
                            <button onclick="router.nav('orders')" class="text-sm text-blue-600 hover:underline">View All</button>
                        </div>
                        <table class="w-full text-left text-sm text-slate-600">
                            <thead class="bg-slate-50 text-xs uppercase font-bold text-slate-400"><tr><th class="p-4">ID</th><th class="p-4">Customer</th><th class="p-4">Date</th><th class="p-4">Total</th><th class="p-4">Status</th></tr></thead>
                            <tbody class="divide-y divide-slate-100">
                                ${app.data.orders.slice(0,5).map(o => `
                                    <tr>
                                        <td class="p-4 font-mono">#${o.id}</td>
                                        <td class="p-4 font-bold text-slate-800">${app.getCustomerName(o.custId)}</td>
                                        <td class="p-4">${o.date}</td>
                                        <td class="p-4 font-bold">$${Number(o.total).toFixed(2)}</td>
                                        <td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold ${o.status==='Shipped'?'bg-emerald-100 text-emerald-700':'bg-amber-100 text-amber-700'}">${o.status}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            renderCustomers(root) {
                root.innerHTML = `
                    <div class="ent-card p-0 overflow-hidden">
                        <table class="w-full text-left text-sm text-slate-600">
                            <thead class="bg-slate-50 text-xs uppercase font-bold text-slate-400">
                                <tr>
                                    <th class="p-4">Name</th><th class="p-4">Email</th><th class="p-4">Company</th><th class="p-4">Location</th><th class="p-4 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">
                                ${app.data.customers.map(c => `
                                    <tr class="hover:bg-slate-50 transition">
                                        <td class="p-4 font-bold text-slate-800">${c.fName} ${c.lName}</td>
                                        <td class="p-4">${c.email}</td>
                                        <td class="p-4">${c.company || '-'}</td>
                                        <td class="p-4">${c.ship_city}, ${c.ship_state}</td>
                                        <td class="p-4 text-right flex justify-end gap-2">
                                            <button onclick="ui.editCustomer('${c.id}')" class="text-blue-600 hover:bg-blue-50 p-2 rounded"><i class="fa fa-pen"></i></button>
                                            <button onclick="app.deleteItem('customers', '${c.id}')" class="text-red-600 hover:bg-red-50 p-2 rounded"><i class="fa fa-trash"></i></button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            renderOrders(root) {
                root.innerHTML = `
                    <div class="ent-card p-0 overflow-hidden">
                        <table class="w-full text-left text-sm text-slate-600">
                            <thead class="bg-slate-50 text-xs uppercase font-bold text-slate-400">
                                <tr>
                                    <th class="p-4">Order ID</th><th class="p-4">Customer</th><th class="p-4">Date</th><th class="p-4">Total</th><th class="p-4">Status</th><th class="p-4 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">
                                ${app.data.orders.map(o => `
                                    <tr class="hover:bg-slate-50 transition">
                                        <td class="p-4 font-mono font-bold">#${o.id}</td>
                                        <td class="p-4 font-bold text-slate-800">${app.getCustomerName(o.custId)}</td>
                                        <td class="p-4">${o.date}</td>
                                        <td class="p-4 text-emerald-600 font-bold">$${Number(o.total).toFixed(2)}</td>
                                        <td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold bg-slate-100">${o.status}</span></td>
                                        <td class="p-4 text-right flex justify-end gap-2">
                                            <button onclick="ui.editOrder('${o.id}')" class="text-blue-600 hover:bg-blue-50 p-2 rounded"><i class="fa fa-pen"></i></button>
                                            <button onclick="app.deleteItem('orders', '${o.id}')" class="text-red-600 hover:bg-red-50 p-2 rounded"><i class="fa fa-trash"></i></button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            renderCalendar(root) {
                const date = new Date();
                const year = date.getFullYear();
                const month = date.getMonth();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const firstDay = new Date(year, month, 1).getDay();
                const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
                
                // US Holidays Logic (Simple implementation for 2025)
                const holidays = {
                    "2025-01-01": "New Year's Day", "2025-07-04": "Independence Day", "2025-11-27": "Thanksgiving", "2025-12-25": "Christmas"
                };

                let html = `
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-800">${monthNames[month]} ${year}</h2>
                        <div class="text-sm text-slate-500">Click any day to manage events</div>
                    </div>
                    <div class="cal-grid">
                `;

                // Empty cells
                for(let i=0; i<firstDay; i++) html += `<div class="cal-day bg-slate-50"></div>`;

                // Days
                for(let d=1; d<=daysInMonth; d++) {
                    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                    const isToday = (d === new Date().getDate());
                    const holiday = holidays[dateStr];
                    const dayEvents = app.data.events.filter(e => e.date === dateStr);

                    html += `
                        <div class="cal-day ${isToday ? 'is-today' : ''}" onclick="ui.openDayView('${dateStr}')">
                            <div class="flex justify-between">
                                <span class="font-bold text-slate-700">${d}</span>
                                ${dayEvents.length > 0 ? `<span class="text-xs text-blue-500 font-bold">${dayEvents.length} Events</span>` : ''}
                            </div>
                            ${holiday ? `<span class="holiday-badge"><i class="fa fa-star"></i> ${holiday}</span>` : ''}
                            <div class="mt-2 space-y-1">
                                ${dayEvents.map(e => `<div class="text-xs truncate text-slate-500"><span class="event-dot"></span>${e.title}</div>`).join('')}
                            </div>
                        </div>
                    `;
                }
                html += `</div>`;
                root.innerHTML = html;
            },

            // --- INTERACTION ---
            openModal(type) {
                document.getElementById(`modal-${type}`).classList.add('open');
                if (type === 'order') {
                    // Populate customer select
                    const sel = document.getElementById('ord-cust-select');
                    sel.innerHTML = app.data.customers.map(c => `<option value="${c.id}">${c.fName} ${c.lName}</option>`).join('');
                }
            },
            closeModal(type) {
                document.getElementById(`modal-${type}`).classList.remove('open');
                // Reset forms
                document.querySelectorAll('form').forEach(f => f.reset());
            },
            toggleBilling(checkbox) {
                const fields = ['addr', 'city', 'state', 'zip', 'country'];
                if (checkbox.checked) {
                    fields.forEach(f => {
                        const val = document.querySelector(`[name="ship_${f}"]`).value;
                        document.querySelector(`[name="bill_${f}"]`).value = val;
                    });
                }
            },
            editCustomer(id) {
                const c = app.data.customers.find(x => x.id === id);
                if(!c) return;
                
                const form = document.getElementById('form-customer');
                // Auto-fill inputs
                Object.keys(c).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if(input) input.value = c[key];
                });
                
                this.openModal('customer');
            },
            editOrder(id) {
                const o = app.data.orders.find(x => x.id === id);
                if(!o) return;
                // Pre-fill logic similar to customer... (implied for brevity)
                this.openModal('order');
            },
            openDayView(dateStr) {
                const modal = document.getElementById('modal-dayview');
                document.getElementById('day-view-title').innerText = new Date(dateStr).toDateString();
                document.getElementById('event-date-input').value = dateStr;
                
                const events = app.data.events.filter(e => e.date === dateStr);
                const container = document.getElementById('day-view-content');
                
                container.innerHTML = events.length ? events.map(e => `
                    <div class="p-3 bg-slate-50 border rounded flex justify-between items-center">
                        <div><div class="font-bold">${e.title}</div><div class="text-xs text-slate-500">${e.type}</div></div>
                        <button onclick="app.deleteItem('events', '${e.id}')" class="text-red-500"><i class="fa fa-trash"></i></button>
                    </div>
                `).join('') : '<p class="text-slate-400 text-sm italic">No events scheduled.</p>';

                modal.classList.add('open');
            },
            showToast(msg) {
                // Simple alert for now, could be a toast component
                alert("âœ“ " + msg);
            }
        };

        // --- ROUTER ---
        const router = {
            current: 'dashboard',
            nav(page) {
                this.current = page;
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                const btn = document.getElementById(`nav-${page}`);
                if(btn) btn.classList.add('active');
                
                document.getElementById('page-title').innerText = page.charAt(0).toUpperCase() + page.slice(1);
                ui.renderCurrent();
            }
        };

        // Start App
        app.init();

    </script>
</body>
</html>
