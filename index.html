<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AcoustiSkin Enterprise ERP - V15</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- CORE THEME --- */
        :root { 
            --sidebar-bg: #0f172a; 
            --sidebar-hover: #1e293b;
            --primary: #2563eb; 
            --bg-main: #f1f5f9; 
            --border: #e2e8f0;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: #334155; height: 100vh; overflow: hidden; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; border: 2px solid #f1f5f9; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* NAVIGATION */
        .nav-item { 
            display: flex; align-items: center; padding: 11px 16px; margin: 2px 8px; 
            color: #94a3b8; border-radius: 6px; cursor: pointer; transition: 0.15s; font-size: 0.85rem; font-weight: 500; 
        }
        .nav-item:hover { background-color: var(--sidebar-hover); color: white; }
        .nav-item.active { background-color: var(--primary); color: white; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3); }
        .nav-icon { width: 24px; text-align: center; margin-right: 12px; font-size: 1rem; }

        /* DATA TABLES */
        .dt-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .dt-table th { background: #f8fafc; color: #64748b; font-weight: 700; text-transform: uppercase; padding: 12px 16px; border-bottom: 1px solid var(--border); text-align: left; font-size: 0.7rem; letter-spacing: 0.05em; }
        .dt-table td { padding: 12px 16px; border-bottom: 1px solid var(--border); color: #1e293b; vertical-align: middle; }
        .dt-table tr:hover { background-color: #f8fafc; }
        .dt-badge { padding: 4px 10px; border-radius: 99px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        
        /* FORMS */
        .form-section-title { font-size: 0.75rem; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 12px; padding-bottom: 6px; border-bottom: 1px solid var(--border); letter-spacing: 0.05em; }
        .inp-label { display: block; font-size: 0.75rem; font-weight: 600; color: #475569; margin-bottom: 4px; }
        .inp-field { width: 100%; border: 1px solid #cbd5e1; border-radius: 6px; padding: 9px 12px; font-size: 0.9rem; transition: border 0.15s; outline: none; background: #fff; }
        .inp-field:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .inp-field[readonly] { background-color: #f1f5f9; color: #64748b; cursor: not-allowed; }

        /* MODALS */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); z-index: 100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-panel { background: #f8fafc; width: 96%; max-width: 1400px; height: 92vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: modalIn 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalIn { from { transform: scale(0.98); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* TABS */
        .tab-bar { display: flex; background: white; border-bottom: 1px solid var(--border); padding: 0 24px; }
        .tab-btn { padding: 16px 20px; font-size: 0.9rem; font-weight: 600; color: #64748b; border-bottom: 2px solid transparent; cursor: pointer; transition: 0.15s; }
        .tab-btn:hover { color: var(--primary); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-pane { display: none; height: 100%; overflow-y: auto; padding: 24px; }
        .tab-pane.active { display: block; }

        /* UI ELEMENTS */
        .card { background: white; border: 1px solid var(--border); border-radius: 8px; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.05); }
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 8px 16px; border-radius: 6px; font-weight: 600; font-size: 0.85rem; transition: 0.15s; cursor: pointer; border: none; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; } .btn-primary:hover { background: #1d4ed8; }
        .btn-success { background: #10b981; color: white; } .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; } .btn-danger:hover { background: #dc2626; }
        .btn-secondary { background: white; border: 1px solid #cbd5e1; color: #475569; } .btn-secondary:hover { background: #f8fafc; }

        /* TOAST */
        #toast-area { position: fixed; bottom: 24px; right: 24px; z-index: 200; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #1e293b; color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); font-size: 0.9rem; display: flex; align-items: center; gap: 12px; animation: slideIn 0.3s ease-out; min-width: 300px; border-left: 4px solid #10b981; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body class="flex">

    <aside class="w-64 bg-slate-900 text-white flex flex-col shadow-2xl z-20 flex-shrink-0">
        <div class="h-16 flex items-center px-6 border-b border-slate-800 bg-slate-950 gap-3">
            <div class="h-8 w-8 bg-blue-600 rounded flex items-center justify-center font-bold shadow-lg shadow-blue-900/50">AS</div>
            <div>
                <h1 class="font-bold text-sm tracking-tight text-white">AcoustiSkin ERP</h1>
                <p class="text-[10px] text-slate-400 font-medium">Enterprise V15</p>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-6">
            <div class="px-6 pb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Operations</div>
            <div onclick="router('dashboard')" class="nav-item active" id="nav-dashboard"><i class="fa-solid fa-chart-line nav-icon"></i> Dashboard</div>
            <div onclick="router('customers')" class="nav-item" id="nav-customers"><i class="fa-solid fa-building nav-icon"></i> Accounts</div>
            <div onclick="router('orders')" class="nav-item" id="nav-orders"><i class="fa-solid fa-file-invoice-dollar nav-icon"></i> Orders</div>
            <div onclick="router('inventory')" class="nav-item" id="nav-inventory"><i class="fa-solid fa-boxes-stacked nav-icon"></i> Inventory</div>
            <div onclick="router('calendar')" class="nav-item" id="nav-calendar"><i class="fa-solid fa-calendar-days nav-icon"></i> Calendar</div>
            
            <div class="px-6 pt-6 pb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Sales & Growth</div>
            <div onclick="router('pipeline')" class="nav-item" id="nav-pipeline"><i class="fa-solid fa-filter nav-icon"></i> Pipeline</div>
            <div onclick="router('marketing')" class="nav-item" id="nav-marketing"><i class="fa-solid fa-bullhorn nav-icon"></i> Marketing</div>
            
            <div class="px-6 pt-6 pb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Admin</div>
            <div onclick="router('settings')" class="nav-item" id="nav-settings"><i class="fa-solid fa-sliders nav-icon"></i> Settings</div>
        </nav>

        <div class="p-4 bg-slate-800 border-t border-slate-700">
            <button onclick="ui.openModal('customer')" class="w-full btn btn-primary justify-center shadow-lg"><i class="fa-solid fa-plus"></i> New Account</button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative overflow-hidden">
        <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 z-10 sticky top-0">
            <div class="flex items-center gap-4">
                <h2 id="page-title" class="text-lg font-bold text-slate-800">Dashboard</h2>
                <div class="h-6 w-px bg-slate-300 mx-2"></div>
                <div class="text-xs text-slate-500" id="current-date"></div>
            </div>
            <div class="flex items-center gap-6">
                <div class="relative">
                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                    <input type="text" placeholder="Global Search (Orders, Customers, SKUs)..." class="pl-10 pr-4 py-2 border border-slate-200 rounded-lg text-sm w-72 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div class="flex items-center gap-3">
                    <div class="text-right hidden md:block">
                        <div class="text-sm font-bold text-slate-700">Dana Lurie</div>
                        <div class="text-xs text-green-600 font-bold bg-green-50 px-2 py-0.5 rounded-full inline-block">Super Admin</div>
                    </div>
                    <div class="h-9 w-9 bg-blue-600 text-white rounded-lg flex items-center justify-center font-bold text-sm shadow-md">DL</div>
                </div>
            </div>
        </header>

        <div id="app-view" class="flex-1 overflow-y-auto p-8 fade-in relative"></div>
    </main>

    <div id="toast-area"></div>

    <div id="modal-customer" class="modal-backdrop">
        <div class="modal-panel">
            <div class="h-16 bg-white border-b px-8 flex justify-between items-center flex-shrink-0">
                <div>
                    <h3 class="font-bold text-xl text-slate-800">Account Profile</h3>
                    <p class="text-xs text-slate-500">Manage customer details, financials, and logistics.</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="ui.closeModal()" class="btn btn-secondary">Cancel</button>
                    <button onclick="act.saveCustomer()" class="btn btn-primary shadow-lg"><i class="fa-solid fa-save"></i> Save Profile</button>
                </div>
            </div>
            
            <form id="form-customer" class="flex-1 flex flex-col overflow-hidden bg-slate-50">
                <input type="hidden" name="id">
                
                <div class="tab-bar">
                    <div onclick="ui.tab('cust', 1)" class="tab-btn active" id="tb-cust-1"><i class="fa-regular fa-building mr-2"></i> Overview</div>
                    <div onclick="ui.tab('cust', 2)" class="tab-btn" id="tb-cust-2"><i class="fa-solid fa-map-location-dot mr-2"></i> Locations</div>
                    <div onclick="ui.tab('cust', 3)" class="tab-btn" id="tb-cust-3"><i class="fa-solid fa-file-invoice-dollar mr-2"></i> Financials</div>
                    <div onclick="ui.tab('cust', 4)" class="tab-btn" id="tb-cust-4"><i class="fa-solid fa-gears mr-2"></i> System</div>
                </div>

                <div id="pane-cust-1" class="tab-pane active">
                    <div class="grid grid-cols-12 gap-8">
                        <div class="col-span-8 space-y-6">
                            <div class="card p-6">
                                <div class="form-section-title">Corporate Identity</div>
                                <div class="grid grid-cols-2 gap-6 mb-4">
                                    <div class="col-span-2"><label class="inp-label">Legal Entity Name *</label><input name="company" class="inp-field" required placeholder="e.g. Amazon Web Services, Inc."></div>
                                    <div><label class="inp-label">DBA (Doing Business As)</label><input name="dba" class="inp-field"></div>
                                    <div><label class="inp-label">Parent Company</label><input name="parent" class="inp-field"></div>
                                </div>
                                <div class="grid grid-cols-3 gap-6">
                                    <div><label class="inp-label">Account Type</label><select name="type" class="inp-field"><option>Corporation</option><option>LLC</option><option>Government</option><option>Reseller</option></select></div>
                                    <div><label class="inp-label">Industry</label><select name="industry" class="inp-field"><option>Retail</option><option>Manufacturing</option><option>Logistics</option><option>Technology</option></select></div>
                                    <div><label class="inp-label">Website</label><input name="website" class="inp-field"></div>
                                </div>
                            </div>

                            <div class="card p-6">
                                <div class="form-section-title">Primary Point of Contact</div>
                                <div class="grid grid-cols-2 gap-6 mb-4">
                                    <div><label class="inp-label">First Name</label><input name="fName" class="inp-field"></div>
                                    <div><label class="inp-label">Last Name</label><input name="lName" class="inp-field"></div>
                                </div>
                                <div class="grid grid-cols-2 gap-6 mb-4">
                                    <div><label class="inp-label">Job Title</label><input name="title" class="inp-field"></div>
                                    <div><label class="inp-label">Department</label><input name="dept" class="inp-field"></div>
                                </div>
                                <div class="grid grid-cols-2 gap-6">
                                    <div><label class="inp-label">Work Email</label><input name="email" class="inp-field"></div>
                                    <div><label class="inp-label">Direct Phone</label><input name="phone" class="inp-field"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-span-4 space-y-6">
                            <div class="card p-6 bg-blue-50 border-blue-100">
                                <div class="form-section-title text-blue-800 border-blue-200">Account Summary</div>
                                <div class="mb-4">
                                    <label class="inp-label text-blue-700">Account Status</label>
                                    <select name="status" class="inp-field border-blue-200 bg-white"><option>Active</option><option>On Hold</option><option>Prospect</option><option>Inactive</option></select>
                                </div>
                                <div class="mb-4">
                                    <label class="inp-label text-blue-700">Account Manager</label>
                                    <input name="owner" class="inp-field border-blue-200" value="Dana Lurie">
                                </div>
                                <div>
                                    <label class="inp-label text-blue-700">Lead Source</label>
                                    <select name="source" class="inp-field border-blue-200"><option>Direct Sales</option><option>Website</option><option>Trade Show</option><option>Referral</option></select>
                                </div>
                            </div>
                            <div class="card p-6">
                                <div class="form-section-title">Internal Notes</div>
                                <textarea name="notes" class="inp-field h-32" placeholder="Private notes about this account..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="pane-cust-2" class="tab-pane">
                    <div class="grid grid-cols-2 gap-8 h-full">
                        <div class="card p-6 h-fit">
                            <div class="form-section-title text-blue-600">Billing Address</div>
                            <div class="mb-4"><label class="inp-label">Address Line 1</label><input name="b_addr1" id="b_addr1" class="inp-field"></div>
                            <div class="mb-4"><label class="inp-label">Address Line 2</label><input name="b_addr2" id="b_addr2" class="inp-field"></div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div><label class="inp-label">City</label><input name="b_city" id="b_city" class="inp-field"></div>
                                <div><label class="inp-label">State / Province</label><input name="b_state" id="b_state" class="inp-field"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="inp-label">Zip / Postal Code</label><input name="b_zip" id="b_zip" class="inp-field"></div>
                                <div><label class="inp-label">Country</label><input name="b_country" id="b_country" class="inp-field" value="USA"></div>
                            </div>
                        </div>
                        <div class="card p-6 h-fit border-l-4 border-l-green-500">
                            <div class="flex justify-between items-center mb-4 border-b pb-2">
                                <div class="form-section-title mb-0 border-0 pb-0 text-green-700">Shipping Address</div>
                                <button type="button" onclick="ui.copyAddr()" class="text-xs bg-slate-100 px-3 py-1 rounded-full text-slate-600 hover:bg-slate-200 border border-slate-300 font-bold">Copy Billing</button>
                            </div>
                            <div class="mb-4"><label class="inp-label">Address Line 1</label><input name="s_addr1" id="s_addr1" class="inp-field"></div>
                            <div class="mb-4"><label class="inp-label">Address Line 2</label><input name="s_addr2" id="s_addr2" class="inp-field"></div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div><label class="inp-label">City</label><input name="s_city" id="s_city" class="inp-field"></div>
                                <div><label class="inp-label">State / Province</label><input name="s_state" id="s_state" class="inp-field"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="inp-label">Zip / Postal Code</label><input name="s_zip" id="s_zip" class="inp-field"></div>
                                <div><label class="inp-label">Country</label><input name="s_country" id="s_country" class="inp-field" value="USA"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="pane-cust-3" class="tab-pane">
                    <div class="grid grid-cols-2 gap-8">
                        <div class="card p-6">
                            <div class="form-section-title">Credit & Terms</div>
                            <div class="grid grid-cols-2 gap-6 mb-4">
                                <div><label class="inp-label">Payment Terms</label><select name="terms" class="inp-field"><option>Net 30</option><option>Net 60</option><option>Net 90</option><option>Due on Receipt</option><option>Prepaid</option></select></div>
                                <div><label class="inp-label">Currency</label><select name="currency" class="inp-field"><option>USD - US Dollar</option><option>EUR - Euro</option><option>CAD - Canadian Dollar</option></select></div>
                            </div>
                            <div class="grid grid-cols-2 gap-6 mb-4">
                                <div><label class="inp-label">Credit Limit ($)</label><input name="creditLimit" type="number" class="inp-field" placeholder="0.00"></div>
                                <div><label class="inp-label">Price Level</label><select name="priceLevel" class="inp-field"><option>Retail</option><option>Wholesale</option><option>Distributor</option></select></div>
                            </div>
                            <div class="grid grid-cols-2 gap-6">
                                <div><label class="inp-label">Tax ID / EIN</label><input name="taxId" class="inp-field"></div>
                                <div><label class="inp-label">DUNS Number</label><input name="duns" class="inp-field"></div>
                            </div>
                        </div>
                        <div class="card p-6">
                            <div class="form-section-title">Logistics Preferences</div>
                            <div class="mb-4">
                                <label class="inp-label">Preferred Carrier</label>
                                <select name="carrier" class="inp-field"><option>FedEx</option><option>UPS</option><option>DHL</option><option>USPS</option><option>Freight</option></select>
                            </div>
                            <div class="mb-4">
                                <label class="inp-label">Carrier Account Number (Third Party Billing)</label>
                                <input name="carrierAcct" class="inp-field" placeholder="e.g. 123456789">
                            </div>
                            <div class="grid grid-cols-2 gap-6">
                                <div><label class="inp-label">FOB Terms</label><select name="fob" class="inp-field"><option>Origin</option><option>Destination</option></select></div>
                                <div><label class="inp-label">Ship Priority</label><select name="shipPri" class="inp-field"><option>Standard</option><option>Expedited</option></select></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="pane-cust-4" class="tab-pane">
                    <div class="card p-6 max-w-xl">
                        <div class="form-section-title">System Metadata</div>
                        <div class="mb-4"><label class="inp-label">Referral Code (Auto-Generated)</label><input name="refCode" class="inp-field font-mono bg-slate-100" readonly></div>
                        <div class="mb-4"><label class="inp-label">Total Lifetime Value</label><input name="ltv" class="inp-field bg-slate-100" readonly value="$0.00"></div>
                        <div class="mb-4"><label class="inp-label">Created Date</label><input name="createdDate" class="inp-field bg-slate-100" readonly></div>
                        <div class="flex items-center gap-2 mt-6">
                            <input type="checkbox" name="marketingOptIn" checked class="w-4 h-4">
                            <label class="text-sm font-medium">Opt-in for Marketing Emails</label>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
<div id="modal-order" class="modal-backdrop">
        <div class="modal-panel">
            <div class="h-16 bg-white border-b px-8 flex justify-between items-center flex-shrink-0">
                <div>
                    <h3 class="font-bold text-xl text-slate-800">Sales Order Entry</h3>
                    <p class="text-xs text-slate-500">Create new invoice or quote</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="ui.closeModal()" class="btn btn-secondary">Close</button>
                    <button onclick="act.saveOrder()" class="btn btn-primary shadow-lg"><i class="fa-solid fa-check"></i> Process Order</button>
                </div>
            </div>
            
            <form id="form-order" class="flex-1 flex flex-col overflow-hidden bg-slate-50">
                <input type="hidden" name="id">
                <div class="flex-1 overflow-y-auto p-8">
                    <div class="card p-6 mb-6">
                        <div class="grid grid-cols-4 gap-6 mb-4">
                            <div><label class="inp-label">Customer *</label><select id="ord-cust" name="custId" class="inp-field font-bold bg-white" onchange="logic.loadCustData(this.value)"></select></div>
                            <div><label class="inp-label">PO Number</label><input name="po" class="inp-field" placeholder="Cust PO#"></div>
                            <div><label class="inp-label">Order Date</label><input type="date" name="date" class="inp-field" required></div>
                            <div><label class="inp-label">Req. Ship Date</label><input type="date" name="shipDate" class="inp-field"></div>
                        </div>
                        <div class="grid grid-cols-4 gap-6">
                            <div><label class="inp-label">Payment Terms</label><input name="terms" id="ord-terms" class="inp-field bg-slate-50" readonly></div>
                            <div><label class="inp-label">Ship Via</label><select name="carrier" id="ord-carrier" class="inp-field"><option>FedEx</option><option>UPS</option><option>DHL</option></select></div>
                            <div><label class="inp-label">Sales Rep</label><input name="rep" value="Dana Lurie" class="inp-field"></div>
                            <div><label class="inp-label">Status</label><select name="status" class="inp-field"><option>Draft</option><option>Pending Fulfillment</option><option>Invoiced</option><option>Paid</option></select></div>
                        </div>
                    </div>

                    <div class="card overflow-hidden mb-6">
                        <div class="bg-slate-100 p-3 border-b flex justify-between items-center">
                            <h4 class="font-bold text-xs uppercase text-slate-600">Line Items</h4>
                            <button type="button" onclick="logic.addLine()" class="btn btn-secondary text-xs py-1"><i class="fa-solid fa-plus"></i> Add Product</button>
                        </div>
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-50 border-b text-xs uppercase font-bold text-slate-500">
                                <tr>
                                    <th class="p-3 w-12 text-center">#</th>
                                    <th class="p-3">Product / SKU</th>
                                    <th class="p-3 w-32 text-right">Qty</th>
                                    <th class="p-3 w-32 text-right">Unit Price</th>
                                    <th class="p-3 w-24 text-right">Disc %</th>
                                    <th class="p-3 w-32 text-right">Total</th>
                                    <th class="p-3 w-12"></th>
                                </tr>
                            </thead>
                            <tbody id="ord-lines">
                                </tbody>
                        </table>
                    </div>

                    <div class="flex justify-end">
                        <div class="w-80 card p-6">
                            <div class="flex justify-between mb-2 text-sm"><span>Subtotal:</span><span id="txt-sub" class="font-bold">$0.00</span></div>
                            <div class="flex justify-between mb-2 text-sm items-center"><span>Shipping:</span><input type="number" id="inp-ship" class="border rounded w-24 text-right p-1 text-sm outline-none focus:border-blue-500" value="0" oninput="logic.calcTotals()"></div>
                            <div class="flex justify-between mb-4 text-sm"><span>Tax (6%):</span><span id="txt-tax">$0.00</span></div>
                            <div class="flex justify-between pt-4 border-t border-slate-200 text-xl font-bold text-slate-800"><span>Total:</span><span id="txt-total" class="text-blue-600">$0.00</span></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- 1. CENTRAL DATABASE STATE ---
        const db = {
            customers: [],
            orders: [],
            inventory: [],
            pipeline: [],
            events: []
        };

        // --- 2. INITIALIZATION ---
        window.onload = () => {
            document.getElementById('current-date').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            const savedData = localStorage.getItem('as_erp_v15');
            if (savedData) {
                Object.assign(db, JSON.parse(savedData));
            } else {
                seedData(); // Load factory defaults if empty
            }
            router('dashboard');
        };

        function seedData() {
            db.customers = [
                { id: 'c1', company: 'Amazon Inc.', fName: 'Jeff', lName: 'Bezos', email: 'ap@amazon.com', type: 'Corporation', industry: 'Technology', status: 'Active', b_city: 'Seattle', b_state: 'WA', terms: 'Net 60', creditLimit: 500000, carrier: 'UPS', carrierAcct: '1X9999' },
                { id: 'c2', company: 'Microsoft Corp', fName: 'Satya', lName: 'Nadella', email: 'purchasing@microsoft.com', type: 'Corporation', industry: 'Technology', status: 'Active', b_city: 'Redmond', b_state: 'WA', terms: 'Net 30', creditLimit: 250000, carrier: 'FedEx' },
                { id: 'c3', company: 'Oracle', fName: 'Larry', lName: 'Ellison', email: 'larry@oracle.com', type: 'Corporation', industry: 'Technology', status: 'Prospect', b_city: 'Austin', b_state: 'TX', terms: 'Net 30', creditLimit: 100000 }
            ];
            db.inventory = [
                { id: 'i1', sku: 'AS-PNL-001', name: 'AcoustiSkin Panel (Standard)', price: 49.95, stock: 1200 },
                { id: 'i2', sku: 'AS-GLUE-5GAL', name: 'Industrial Adhesive 5gal', price: 125.00, stock: 400 },
                { id: 'i3', sku: 'AS-KIT-PRO', name: 'Professional Install Kit', price: 89.00, stock: 150 }
            ];
            db.orders = [
                { id: '10001', custId: 'c1', custName: 'Amazon Inc.', po: 'PO-998877', date: '2025-11-15', total: 12500.00, status: 'Paid', items: [{sku:'AS-PNL-001', qty:250, price:49.95, total:12487.50}] }
            ];
            save();
        }

        function save() { localStorage.setItem('as_erp_v15', JSON.stringify(db)); }

        // --- 3. ROUTER ---
        function router(view) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const nav = document.getElementById('nav-' + view);
            if (nav) nav.classList.add('active');
            
            const container = document.getElementById('app-view');
            
            if (view === 'dashboard') renderDashboard(container);
            else if (view === 'customers') renderCustomers(container);
            else if (view === 'orders') renderOrders(container);
            else if (view === 'inventory') renderInventory(container);
            else if (view === 'settings') container.innerHTML = `<div class="p-10 text-center"><button onclick="act.reset()" class="btn btn-danger shadow-lg">Factory Reset System</button></div>`;
            else container.innerHTML = `<div class="flex items-center justify-center h-full text-slate-400">Module '${view}' is active in Enterprise Plan.</div>`;
        }

        // --- 4. RENDERERS ---
        function renderDashboard(c) {
            const totalRev = db.orders.reduce((a,b) => a + (parseFloat(b.total)||0), 0);
            c.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="card p-6 border-l-4 border-blue-500">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wider">YTD Revenue</div>
                        <div class="text-2xl font-bold text-slate-800 mt-2">$${totalRev.toLocaleString(undefined, {minimumFractionDigits:2})}</div>
                    </div>
                    <div class="card p-6 border-l-4 border-green-500">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wider">Active Accounts</div>
                        <div class="text-2xl font-bold text-slate-800 mt-2">${db.customers.length}</div>
                    </div>
                    <div class="card p-6 border-l-4 border-purple-500">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wider">Open Orders</div>
                        <div class="text-2xl font-bold text-slate-800 mt-2">${db.orders.filter(o=>o.status!=='Paid').length}</div>
                    </div>
                    <div class="card p-6 border-l-4 border-orange-500">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wider">Low Stock Alerts</div>
                        <div class="text-2xl font-bold text-slate-800 mt-2">${db.inventory.filter(i=>i.stock<100).length}</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="card p-6">
                        <h3 class="font-bold text-slate-700 mb-4">Recent Transactions</h3>
                        <table class="dt-table">
                            <thead><tr><th>PO #</th><th>Customer</th><th>Amount</th><th>Status</th></tr></thead>
                            <tbody>
                                ${db.orders.slice(0,5).map(o => `
                                    <tr>
                                        <td class="font-mono text-xs text-slate-500">${o.po||'N/A'}</td>
                                        <td class="font-bold text-sm">${o.custName}</td>
                                        <td class="font-bold text-green-600 text-sm">$${o.total.toLocaleString()}</td>
                                        <td><span class="dt-badge bg-slate-100 text-slate-600">${o.status}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-slate-700 mb-4">Top Accounts</h3>
                        <div class="space-y-4">
                            ${db.customers.slice(0,5).map(c => `
                                <div class="flex justify-between items-center border-b border-slate-50 pb-2">
                                    <div><div class="font-bold text-sm text-slate-800">${c.company}</div><div class="text-xs text-slate-400">${c.b_city}, ${c.b_state}</div></div>
                                    <div class="text-right"><div class="text-xs font-bold text-blue-600">${c.type}</div></div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCustomers(c) {
            c.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-slate-800">Account List</h2>
                    <button onclick="ui.modal('customer')" class="btn btn-primary shadow"><i class="fa-solid fa-plus"></i> New Account</button>
                </div>
                <div class="card overflow-hidden">
                    <table class="dt-table">
                        <thead><tr><th>Company</th><th>Contact</th><th>Terms</th><th>Credit Limit</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody>
                            ${db.customers.map(c => `
                                <tr>
                                    <td class="font-bold text-blue-900">${c.company}</td>
                                    <td>${c.fName} ${c.lName}<br><span class="text-xs text-slate-400">${c.email}</span></td>
                                    <td><span class="text-xs bg-slate-100 px-2 py-1 rounded font-bold">${c.terms || 'Net 30'}</span></td>
                                    <td class="font-mono text-xs">$${(parseInt(c.creditLimit)||0).toLocaleString()}</td>
                                    <td><span class="dt-badge ${c.status==='Active'?'bg-green-100 text-green-700':'bg-slate-100 text-slate-600'}">${c.status}</span></td>
                                    <td>
                                        <button onclick="ui.editCust('${c.id}')" class="text-blue-600 hover:text-blue-800 mr-3"><i class="fa-solid fa-pen"></i></button>
                                        <button onclick="act.delete('customers','${c.id}')" class="text-red-500 hover:text-red-700"><i class="fa-solid fa-trash"></i></button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderOrders(c) {
            c.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-slate-800">Sales Orders</h2>
                    <button onclick="ui.modal('order')" class="btn btn-primary shadow"><i class="fa-solid fa-plus"></i> Create Order</button>
                </div>
                <div class="card overflow-hidden">
                    <table class="dt-table">
                        <thead><tr><th>Order #</th><th>Date</th><th>Customer</th><th>PO #</th><th>Total</th><th>Status</th><th>Action</th></tr></thead>
                        <tbody>
                            ${db.orders.map(o => `
                                <tr>
                                    <td class="font-mono font-bold text-slate-600">#${o.id}</td>
                                    <td>${o.date}</td>
                                    <td class="font-bold">${o.custName}</td>
                                    <td class="font-mono text-xs">${o.po || '-'}</td>
                                    <td class="font-bold text-green-600">$${o.total.toLocaleString()}</td>
                                    <td><span class="dt-badge bg-slate-100 text-slate-600">${o.status}</span></td>
                                    <td><button onclick="ui.editOrder('${o.id}')" class="text-blue-600 hover:underline text-xs font-bold">Manage</button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderInventory(c) {
            c.innerHTML = `
                <div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold text-slate-800">Inventory</h2><button class="btn btn-secondary">Import CSV</button></div>
                <div class="card overflow-hidden">
                    <table class="dt-table">
                        <thead><tr><th>SKU</th><th>Product Name</th><th>Price</th><th>Stock</th><th>Value</th></tr></thead>
                        <tbody>
                            ${db.inventory.map(i => `
                                <tr>
                                    <td class="font-mono text-xs font-bold text-slate-600">${i.sku}</td>
                                    <td class="font-bold">${i.name}</td>
                                    <td>$${i.price.toFixed(2)}</td>
                                    <td><span class="${i.stock<200?'text-red-600 font-bold':'text-green-600'}">${i.stock}</span></td>
                                    <td class="font-mono text-xs">$${(i.price*i.stock).toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // --- 5. LOGIC & ACTIONS ---
        const ui = {
            modal(id) { 
                document.getElementById(`modal-${id}`).style.display = 'flex';
                if(id === 'order') {
                    const sel = document.getElementById('ord-cust');
                    sel.innerHTML = `<option value="">-- Select Account --</option>` + db.customers.map(c => `<option value="${c.id}">${c.company}</option>`).join('');
                    document.getElementById('ord-lines').innerHTML = '';
                    logic.addLine(); // Start with 1 line
                }
            },
            closeModal() {
                document.querySelectorAll('.modal-backdrop').forEach(el => el.style.display = 'none');
                document.querySelectorAll('form').forEach(f => f.reset());
            },
            tab(grp, idx) {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                document.getElementById(`tb-${grp}-${idx}`).classList.add('active');
                document.getElementById(`pane-${grp}-${idx}`).classList.add('active');
            },
            copyAddr() {
                ['addr1','addr2','city','state','zip','country'].forEach(k => {
                    const src = document.getElementById(`b_${k}`);
                    const dest = document.getElementById(`s_${k}`);
                    if(src && dest) dest.value = src.value;
                });
                this.toast('Billing address copied to shipping.');
            },
            toast(msg) {
                const t = document.createElement('div');
                t.className = 'toast';
                t.innerHTML = `<i class="fa-solid fa-circle-check text-green-400"></i> ${msg}`;
                document.getElementById('toast-area').appendChild(t);
                setTimeout(() => t.remove(), 3000);
            },
            editCust(id) {
                const c = db.customers.find(x=>x.id===id);
                if(!c) return;
                const f = document.getElementById('form-customer');
                f.elements['id'].value = id;
                Object.keys(c).forEach(k => { if(f.elements[k]) f.elements[k].value = c[k]; });
                this.modal('customer');
            },
            editOrder(id) {
                const o = db.orders.find(x=>x.id===id);
                if(!o) return;
                const f = document.getElementById('form-order');
                f.elements['id'].value = id;
                f.elements['po'].value = o.po || '';
                f.elements['date'].value = o.date;
                f.elements['status'].value = o.status;
                
                // Load Customer
                logic.loadCustData(o.custId, () => {
                    // Load Items
                    const lines = document.getElementById('ord-lines');
                    lines.innerHTML = '';
                    if(o.items && o.items.length) {
                        o.items.forEach(item => logic.addLine(item));
                    } else {
                        logic.addLine();
                    }
                    logic.calcTotals();
                });
                
                document.getElementById('modal-order').style.display = 'flex';
            }
        };

        const logic = {
            loadCustData(id, callback) {
                const cust = db.customers.find(c => c.id === id);
                if(cust) {
                    const sel = document.getElementById('ord-cust');
                    if(sel.value !== id) {
                        // If function called manually, set the select
                        sel.innerHTML = `<option value="${cust.id}" selected>${cust.company}</option>` + db.customers.filter(c=>c.id!==id).map(c=>`<option value="${c.id}">${c.company}</option>`).join('');
                    }
                    document.getElementById('ord-terms').value = cust.terms || '';
                    document.getElementById('ord-carrier').value = cust.carrier || 'FedEx';
                }
                if(callback) callback();
            },
            addLine(data) {
                const row = document.createElement('tr');
                row.className = 'border-b';
                row.innerHTML = `
                    <td class="p-3 text-center text-slate-400">#</td>
                    <td class="p-3"><input class="inp-field" name="sku" placeholder="SKU / Desc" value="${data?data.sku:''}"></td>
                    <td class="p-3"><input type="number" class="inp-field text-right" name="qty" value="${data?data.qty:1}" oninput="logic.calcTotals()"></td>
                    <td class="p-3"><input type="number" class="inp-field text-right" name="price" value="${data?data.price:0.00}" step="0.01" oninput="logic.calcTotals()"></td>
                    <td class="p-3"><input type="number" class="inp-field text-right" name="disc" value="${data?data.disc||0:0}" placeholder="0" oninput="logic.calcTotals()"></td>
                    <td class="p-3 text-right font-bold text-slate-700 line-total">$0.00</td>
                    <td class="p-3 text-center"><i class="fa-solid fa-trash text-red-400 cursor-pointer hover:text-red-600" onclick="this.closest('tr').remove();logic.calcTotals()"></i></td>
                `;
                document.getElementById('ord-lines').appendChild(row);
                logic.calcTotals();
            },
            calcTotals() {
                let sub = 0;
                document.querySelectorAll('#ord-lines tr').forEach(r => {
                    const qty = parseFloat(r.querySelector('[name="qty"]').value) || 0;
                    const price = parseFloat(r.querySelector('[name="price"]').value) || 0;
                    const disc = parseFloat(r.querySelector('[name="disc"]').value) || 0;
                    const total = (qty * price) * (1 - disc/100);
                    r.querySelector('.line-total').innerText = '$' + total.toFixed(2);
                    sub += total;
                });
                const ship = parseFloat(document.getElementById('inp-ship').value) || 0;
                const tax = sub * 0.06;
                const grand = sub + ship + tax;
                
                document.getElementById('txt-sub').innerText = '$' + sub.toFixed(2);
                document.getElementById('txt-tax').innerText = '$' + tax.toFixed(2);
                document.getElementById('txt-total').innerText = '$' + grand.toFixed(2);
            }
        };

        const act = {
            saveCustomer() {
                const f = document.getElementById('form-customer');
                const fd = new FormData(f);
                const obj = Object.fromEntries(fd.entries());
                
                if (!obj.id) {
                    obj.id = 'c' + Date.now();
                    obj.createdDate = new Date().toISOString().split('T')[0];
                    obj.refCode = (obj.company.substring(0,3) + '2025').toUpperCase();
                    db.customers.push(obj);
                } else {
                    const idx = db.customers.findIndex(c => c.id === obj.id);
                    if(idx > -1) db.customers[idx] = { ...db.customers[idx], ...obj };
                }
                
                save();
                ui.closeModal();
                ui.toast('Account saved successfully.');
                router('customers');
            },
            saveOrder() {
                const f = document.getElementById('form-order');
                const fd = new FormData(f);
                const obj = Object.fromEntries(fd.entries());
                
                // Get Customer Name
                const sel = document.getElementById('ord-cust');
                if(sel.selectedIndex > -1) obj.custName = sel.options[sel.selectedIndex].text;
                
                // Get Lines
                obj.items = [];
                document.querySelectorAll('#ord-lines tr').forEach(r => {
                    obj.items.push({
                        sku: r.querySelector('[name="sku"]').value,
                        qty: parseFloat(r.querySelector('[name="qty"]').value),
                        price: parseFloat(r.querySelector('[name="price"]').value),
                        disc: parseFloat(r.querySelector('[name="disc"]').value),
                        total: parseFloat(r.querySelector('.line-total').innerText.replace('$',''))
                    });
                });
                
                // Get Totals
                obj.total = parseFloat(document.getElementById('txt-total').innerText.replace('$',''));
                
                if (!obj.id) obj.id = Math.floor(Math.random() * 90000) + 10000;
                
                // Update or Add
                const idx = db.orders.findIndex(o => o.id == obj.id);
                if(idx > -1) db.orders[idx] = obj;
                else db.orders.unshift(obj);
                
                save();
                ui.closeModal();
                ui.toast('Order processed successfully.');
                router('orders');
            },
            delete(col, id) {
                if(confirm('Are you sure? This action cannot be undone.')) {
                    db[col] = db[col].filter(x => x.id !== id);
                    save();
                    router(col);
                    ui.toast('Record deleted.');
                }
            },
            reset() {
                if(confirm('WARNING: Factory Reset will erase all data. Continue?')) {
                    localStorage.removeItem('as_erp_v15');
                    location.reload();
                }
            }
        };
    </script>
</body>
</html>
